<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced 3D RollerCoin Calculator</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
:root {
    --primary-color: #1a1f3c;
    --secondary-color: #4a90e2;
    --accent-color: #ff6b6b;
    --text-color: #ffffff;
    --card-bg: rgba(28, 39, 60, 0.8);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', 'Arial', sans-serif;
}

body {
    background: linear-gradient(135deg, #0f172a, #1e293b);
    color: var(--text-color);
    min-height: 100vh;
    perspective: 1000px;
}

#background-canvas {
    position: fixed;
    top: 0;
    left: 0;
    z-index: -1;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
    transform-style: preserve-3d;
}

.calculator-section {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    padding: 2.5rem;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    margin-bottom: 2rem;
    animation: float 6s ease-in-out infinite;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transform-style: preserve-3d;
}

.input-group {
    margin-bottom: 2rem;
    transform: translateZ(20px);
}

h1 {
    font-size: 2.5rem;
    margin-bottom: 2rem;
    background: linear-gradient(45deg, var(--secondary-color), var(--accent-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-align: center;
    transform: translateZ(30px);
}

label {
    display: block;
    margin-bottom: 0.8rem;
    font-weight: 600;
    color: var(--secondary-color);
    font-size: 1.1rem;
    transform: translateZ(10px);
}

input {
    width: 100%;
    padding: 1rem;
    border: 2px solid rgba(74, 144, 226, 0.3);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-color);
    font-size: 1.1rem;
    transition: all 0.3s ease;
    transform: translateZ(15px);
}

input:focus {
    outline: none;
    border-color: var(--secondary-color);
    box-shadow: 0 0 15px rgba(74, 144, 226, 0.3);
}

button {
    background: linear-gradient(45deg, var(--secondary-color), #2980b9);
    color: white;
    border: none;
    padding: 1.2rem 2.5rem;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1.1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    transform: translateZ(20px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

button:hover {
    transform: translateZ(25px) translateY(-2px);
    box-shadow: 0 8px 20px rgba(74, 144, 226, 0.4);
}

.crypto-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-top: 3rem;
    perspective: 1000px;
}

.crypto-card {
    background: var(--card-bg);
    padding: 2rem;
    border-radius: 15px;
    text-align: center;
    transition: all 0.4s ease;
    position: relative;
    transform-style: preserve-3d;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.crypto-card:hover {
    transform: translateZ(20px) rotateX(5deg) rotateY(5deg);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
}

.crypto-icon {
    width: 60px;
    height: 60px;
    margin-bottom: 1.5rem;
    filter: drop-shadow(0 0 10px rgba(74, 144, 226, 0.5));
    transform: translateZ(30px);
}

.crypto-name {
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 1rem;
    color: var(--secondary-color);
    transform: translateZ(25px);
}

.income-display {
    margin-top: 1.5rem;
    font-size: 1rem;
    transform: translateZ(20px);
}

.daily-income, .monthly-income {
    display: block;
    margin-top: 0.8rem;
    color: #4a90e2;
    font-weight: 500;
}

.ad-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    backdrop-filter: blur(8px);
}

.ad-content {
    background: var(--card-bg);
    padding: 2rem;
    border-radius: 20px;
    max-width: 800px;
    width: 90%;
    position: relative;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.ad-media {
    width: 100%;
    max-height: 450px;
    object-fit: contain;
    border-radius: 10px;
    margin-bottom: 1rem;
    cursor: pointer;
}

.close-ad {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: var(--accent-color);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    display: none;
}

@keyframes float {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
</head>
<body>
<canvas id="background-canvas"></canvas>
<div class="container">
    <div class="calculator-section">
        <h1>RollerCoin Calculator</h1>
        <div class="input-group">
            <label for="power">Mining Power (PH/s)</label>
            <input type="number" id="power" placeholder="Enter your mining power" min="0">
        </div>
        <button onclick="calculateIncome()" id="calculateBtn">Calculate Income</button>
        <div class="results" id="results"></div>
    </div>

    <div class="crypto-list" id="cryptoList"></div>
</div>

<script>
// Three.js Background Animation
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('background-canvas'), alpha: true });
renderer.setSize(window.innerWidth, window.innerHeight);

const geometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
const material = new THREE.MeshBasicMaterial({ 
    color: 0x4a90e2,
    wireframe: true,
    transparent: true,
    opacity: 0.1
});
const torusKnot = new THREE.Mesh(geometry, material);
scene.add(torusKnot);

camera.position.z = 30;

function animate() {
    requestAnimationFrame(animate);
    torusKnot.rotation.x += 0.001;
    torusKnot.rotation.y += 0.002;
    renderer.render(scene, camera);
}
animate();

// Cryptocurrencies configuration
const cryptocurrencies = [
    { symbol: 'RLT', name: 'RollerToken', iconFile: 'rlt.svg' },
    { symbol: 'RST', name: 'RollerStarter', iconFile: 'rst.svg' },
    { symbol: 'XRP', name: 'Ripple', iconFile: 'xrp.svg' },
    { symbol: 'TRX', name: 'TRON', iconFile: 'trx.svg' },
    { symbol: 'DOGE', name: 'Dogecoin', iconFile: 'doge.svg' },
    { symbol: 'BTC', name: 'Bitcoin', iconFile: 'btc.svg' },
    { symbol: 'ETH', name: 'Ethereum', iconFile: 'eth.svg' },
    { symbol: 'BNB', name: 'Binance Coin', iconFile: 'bnb.svg' },
    { symbol: 'POL', name: 'Polygon', iconFile: 'pol.svg' },
    { symbol: 'SOL', name: 'Solana', iconFile: 'sol.svg' },
    { symbol: 'LTC', name: 'Litecoin', iconFile: 'ltc.svg' }
];

// Ad System
async function loadAdsConfig() {
    try {
        const response = await fetch('http://65.108.28.116:5000/ads');
        if (!response.ok) {
            throw new Error('Failed to load ads configuration');
        }
        return await response.json();
    } catch (error) {
        console.error('Error loading ads:', error);
        return { ads: [] };
    }
}

async function showAd() {
    try {
        const adsConfig = await loadAdsConfig();
        if (!adsConfig.ads || adsConfig.ads.length === 0) return;

        const ad = adsConfig.ads[Math.floor(Math.random() * adsConfig.ads.length)];
        const modal = document.createElement('div');
        modal.className = 'ad-modal';

        const content = document.createElement('div');
        content.className = 'ad-content';

        let mediaElement;
        if (ad.type === 'video') {
            mediaElement = document.createElement('video');
            mediaElement.autoplay = true;
            mediaElement.controls = false;
            mediaElement.muted = true;
            mediaElement.loop = true;
        } else {
            mediaElement = document.createElement('img');
        }

        mediaElement.className = 'ad-media';
        mediaElement.src = ad.source;
        mediaElement.onclick = () => window.open(ad.link, '_blank');

        const closeButton = document.createElement('button');
        closeButton.className = 'close-ad';
        closeButton.textContent = 'Close Ad';
        closeButton.style.display = 'none';

        // Show close button after 3 seconds
        setTimeout(() => {
            closeButton.style.display = 'block';
        }, 3000);

        closeButton.onclick = () => {
            modal.remove();
        };

        content.appendChild(mediaElement);
        content.appendChild(closeButton);
        modal.appendChild(content);
        document.body.appendChild(modal);

    } catch (error) {
        console.error('Error showing ad:', error);
    }
}

function initializeCryptoList() {
    const cryptoList = document.getElementById('cryptoList');
    cryptoList.innerHTML = '';
    
    cryptocurrencies.forEach(crypto => {
        const card = document.createElement('div');
        card.className = 'crypto-card';
        card.innerHTML = `
            <img src="${crypto.iconFile}" class="crypto-icon" alt="${crypto.name} icon">
            <div class="crypto-name">${crypto.name}</div>
            <div class="crypto-symbol">${crypto.symbol}</div>
            <div class="income-display">
                <span class="daily-income" id="daily-${crypto.symbol}">Daily: --</span>
                <span class="monthly-income" id="monthly-${crypto.symbol}">Monthly: --</span>
            </div>
        `;
        cryptoList.appendChild(card);
    });
}

async function calculateIncome() {
    const power = parseFloat(document.getElementById('power').value);
    if (isNaN(power) || power <= 0) {
        alert('Please enter a valid mining power value');
        return;
    }

    try {
        const response = await fetch('http://65.108.28.116:5000/calculate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ power: power })
        });

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();

        cryptocurrencies.forEach(crypto => {
            if (data[crypto.symbol.toLowerCase()]) {
                const result = data[crypto.symbol.toLowerCase()];
                document.getElementById(`daily-${crypto.symbol}`).textContent = 
                    `Daily: ${result.daily.toFixed(8)} ${result.unit}`;
                document.getElementById(`monthly-${crypto.symbol}`).textContent = 
                    `Monthly: ${result.monthly.toFixed(8)} ${result.unit}`;
            }
        });
    } catch (error) {
            console.error('Error fetching income data:', error);
            alert('Failed to fetch income data. Please try again.');
        }
    }

    window.onload = () => {
        initializeCryptoList();
        showAd();
    };

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Handle Telegram WebApp initialization
    if (window.Telegram && window.Telegram.WebApp) {
        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
    }

    // Listen for power updates from the main app
    window.addEventListener('message', async (event) => {
        if (event.data && event.data.power) {
            const powerInput = document.getElementById('power');
            powerInput.value = event.data.power;
            await calculateIncome();
        }
    });
</script>
</body>
</html>
